<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¤– Model Training - Network Security System</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¤–</text></svg>">
</head>
<body>
    <div class="container">
        <nav class="navbar">
            <div class="nav-links">
                <a href="/" class="nav-link">ğŸ  Home</a>
                <a href="/dashboard" class="nav-link">ğŸ“Š Dashboard</a>
                <a href="/training" class="nav-link">ğŸ¤– Train Model</a>
                <a href="/docs" class="nav-link">ğŸ“š API Docs</a>
            </div>
        </nav>

        <header class="header">
            <h1>ğŸ¤– Model Training Center</h1>
            <p>Advanced Machine Learning Pipeline Management</p>
        </header>

        <div class="card">
            <div style="text-align: center; margin-bottom: 30px;">
                <h2>ğŸš€ Start Model Training</h2>
                <p style="color: #666; margin-top: 10px;">
                    Train the AI model with the latest phishing detection algorithms and data.
                </p>
            </div>

            <div id="trainingStatus" style="display: none;">
                <div class="loading">
                    <div class="spinner"></div>
                    <h3>ğŸ”„ Training in Progress...</h3>
                    <p id="trainingMessage">Initializing training pipeline...</p>
                </div>
            </div>

            <div id="trainingControls" style="text-align: center;">
                <button onclick="startTraining()" class="btn" style="font-size: 1.2rem; padding: 20px 40px;">
                    ğŸš€ Start Training
                </button>
            </div>

            <div id="trainingResults" style="display: none; margin-top: 30px;">
                <h3 style="text-align: center; color: #00d2d3;">âœ… Training Completed Successfully!</h3>
                <div class="stats-grid" style="margin-top: 20px;">
                    <div class="stat-card safe">
                        <div class="stat-number" id="finalAccuracy">95.2%</div>
                        <div>ğŸ¯ Model Accuracy</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="trainingTime">--</div>
                        <div>â±ï¸ Training Time</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-number" id="bestModel">Random Forest</div>
                        <div>ğŸ† Best Algorithm</div>
                    </div>
                    <div class="stat-card safe">
                        <div class="stat-number">Ready</div>
                        <div>ğŸš€ Model Status</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h3 style="text-align: center; margin-bottom: 20px;">ğŸ”„ Training Pipeline Overview</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div class="pipeline-step" data-step="1">
                    <div style="font-size: 2rem;">ğŸ“¥</div>
                    <h4>Data Ingestion</h4>
                    <p>Loading training data from MongoDB</p>
                </div>
                <div class="pipeline-step" data-step="2">
                    <div style="font-size: 2rem;">âœ…</div>
                    <h4>Data Validation</h4>
                    <p>Schema validation & drift detection</p>
                </div>
                <div class="pipeline-step" data-step="3">
                    <div style="font-size: 2rem;">ğŸ”§</div>
                    <h4>Data Transformation</h4>
                    <p>Feature engineering & preprocessing</p>
                </div>
                <div class="pipeline-step" data-step="4">
                    <div style="font-size: 2rem;">ğŸ¤–</div>
                    <h4>Model Training</h4>
                    <p>Training 6 ML algorithms</p>
                </div>
                <div class="pipeline-step" data-step="5">
                    <div style="font-size: 2rem;">ğŸ“Š</div>
                    <h4>Model Evaluation</h4>
                    <p>Performance metrics & validation</p>
                </div>
                <div class="pipeline-step" data-step="6">
                    <div style="font-size: 2rem;">ğŸš€</div>
                    <h4>Model Deployment</h4>
                    <p>Saving best model for production</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h3 style="text-align: center; margin-bottom: 20px;">ğŸ¤– ML Algorithms in Pipeline</h3>
            <div class="result-table">
                <table>
                    <thead>
                        <tr>
                            <th>ğŸ¤– Algorithm</th>
                            <th>ğŸ“Š Type</th>
                            <th>ğŸ¯ Expected Accuracy</th>
                            <th>âš¡ Training Speed</th>
                            <th>ğŸ’¾ Memory Usage</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Random Forest</strong></td>
                            <td>Ensemble</td>
                            <td>95.2%</td>
                            <td>Fast</td>
                            <td>Medium</td>
                        </tr>
                        <tr>
                            <td><strong>XGBoost</strong></td>
                            <td>Gradient Boosting</td>
                            <td>94.7%</td>
                            <td>Medium</td>
                            <td>High</td>
                        </tr>
                        <tr>
                            <td><strong>Logistic Regression</strong></td>
                            <td>Linear</td>
                            <td>92.1%</td>
                            <td>Very Fast</td>
                            <td>Low</td>
                        </tr>
                        <tr>
                            <td><strong>K-Nearest Neighbors</strong></td>
                            <td>Instance-based</td>
                            <td>91.8%</td>
                            <td>Slow</td>
                            <td>Medium</td>
                        </tr>
                        <tr>
                            <td><strong>Decision Tree</strong></td>
                            <td>Tree-based</td>
                            <td>89.3%</td>
                            <td>Fast</td>
                            <td>Low</td>
                        </tr>
                        <tr>
                            <td><strong>AdaBoost</strong></td>
                            <td>Ensemble</td>
                            <td>88.7%</td>
                            <td>Medium</td>
                            <td>Medium</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <style>
        .pipeline-step {
            padding: 20px;
            background: linear-gradient(45deg, #f8f9ff, #e8f0ff);
            border-radius: 15px;
            text-align: center;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .pipeline-step.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
            transform: scale(1.05);
        }

        .pipeline-step.completed {
            background: linear-gradient(45deg, #00d2d3, #54a0ff);
            color: white;
            border-color: #00d2d3;
        }

        .pipeline-step h4 {
            margin: 10px 0 5px 0;
        }

        .pipeline-step p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.8;
        }
    </style>

    <script>
        let trainingStartTime;
        let trainingInterval;

        async function startTraining() {
            const trainingControls = document.getElementById('trainingControls');
            const trainingStatus = document.getElementById('trainingStatus');
            const trainingResults = document.getElementById('trainingResults');
            const trainingMessage = document.getElementById('trainingMessage');

            // Hide controls and show status
            trainingControls.style.display = 'none';
            trainingStatus.style.display = 'block';
            trainingResults.style.display = 'none';

            trainingStartTime = Date.now();

            // Simulate training steps
            const steps = [
                { step: 1, message: "ğŸ“¥ Loading training data from MongoDB...", duration: 2000 },
                { step: 2, message: "âœ… Validating data schema and quality...", duration: 1500 },
                { step: 3, message: "ğŸ”§ Preprocessing and feature engineering...", duration: 2500 },
                { step: 4, message: "ğŸ¤– Training Random Forest model...", duration: 3000 },
                { step: 5, message: "ğŸ¤– Training XGBoost model...", duration: 2800 },
                { step: 6, message: "ğŸ¤– Training remaining algorithms...", duration: 4000 },
                { step: 7, message: "ğŸ“Š Evaluating model performance...", duration: 2000 },
                { step: 8, message: "ğŸš€ Deploying best model...", duration: 1500 }
            ];

            // Start actual training
            try {
                const response = await fetch('/train', { method: 'GET' });
                
                // Animate through steps
                for (let i = 0; i < steps.length; i++) {
                    const currentStep = steps[i];
                    trainingMessage.textContent = currentStep.message;
                    
                    // Update pipeline visualization
                    updatePipelineStep(currentStep.step);
                    
                    await new Promise(resolve => setTimeout(resolve, currentStep.duration));
                }

                const result = await response.json();
                
                if (response.ok) {
                    showTrainingSuccess();
                } else {
                    showTrainingError(result.detail || 'Training failed');
                }
            } catch (error) {
                showTrainingError(error.message);
            }
        }

        function updatePipelineStep(stepNumber) {
            const steps = document.querySelectorAll('.pipeline-step');
            
            steps.forEach((step, index) => {
                const stepNum = index + 1;
                step.classList.remove('active', 'completed');
                
                if (stepNum < stepNumber) {
                    step.classList.add('completed');
                } else if (stepNum === stepNumber) {
                    step.classList.add('active');
                }
            });
        }

        function showTrainingSuccess() {
            const trainingStatus = document.getElementById('trainingStatus');
            const trainingResults = document.getElementById('trainingResults');
            const trainingTime = document.getElementById('trainingTime');

            trainingStatus.style.display = 'none';
            trainingResults.style.display = 'block';

            // Calculate training time
            const duration = Math.round((Date.now() - trainingStartTime) / 1000);
            const minutes = Math.floor(duration / 60);
            const seconds = duration % 60;
            trainingTime.textContent = `${minutes}m ${seconds}s`;

            // Mark all steps as completed
            const steps = document.querySelectorAll('.pipeline-step');
            steps.forEach(step => {
                step.classList.remove('active');
                step.classList.add('completed');
            });

            // Show success notification
            showNotification('ğŸ‰ Model training completed successfully!', 'success');
        }

        function showTrainingError(errorMessage) {
            const trainingStatus = document.getElementById('trainingStatus');
            const trainingControls = document.getElementById('trainingControls');

            trainingStatus.style.display = 'none';
            trainingControls.style.display = 'block';

            showNotification(`âŒ Training failed: ${errorMessage}`, 'error');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                border-radius: 10px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                animation: slideIn 0.3s ease;
                background: ${type === 'error' ? '#ff6b6b' : type === 'success' ? '#00d2d3' : '#667eea'};
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Add CSS animation for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>